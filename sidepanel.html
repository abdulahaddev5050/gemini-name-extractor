<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Client Extractor</title>
    <style>
        /* ============ COLOR PALETTE ============
           --black: #000000
           --prussian-blue: #14213d (Primary)
           --orange: #fca311 (Accent)
           --alabaster-grey: #e5e5e5 (Background)
           --white: #ffffff
        ========================================== */
        
        :root {
            --black: #000000;
            --prussian-blue: #14213d;
            --orange: #fca311;
            --alabaster: #e5e5e5;
            --white: #ffffff;
            --prussian-light: #1d3557;
            --orange-hover: #e59400;
        }

        * {
            box-sizing: border-box;
        }
        html, body {
            min-width: 280px;
            max-width: 100%;
            overflow-x: hidden;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 12px;
            color: var(--black);
            background-color: var(--white);
            margin: 0;
        }

        /* --- Section Headers --- */
        .section-header {
            font-size: 14px;
            font-weight: 700;
            color: var(--prussian-blue);
            margin: 15px 0 8px 0;
            padding-bottom: 4px;
            border-bottom: 2px solid var(--alabaster);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .section-header .step-num {
            background: var(--prussian-blue);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
        }

        /* --- Upload Button --- */
        #computerBtn {
            background-color: var(--prussian-blue);
            color: var(--white);
            border: none;
            padding: 14px;
            width: 100%;
            font-size: 15px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 10px;
        }
        #computerBtn:hover {
            background-color: var(--prussian-light);
        }

        /* --- Table --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            table-layout: fixed;
        }
        td, th {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        thead {
            background-color: var(--alabaster);
        }
        th {
            text-align: left;
            padding: 8px;
            font-weight: bold;
            color: var(--prussian-blue);
            border-bottom: 2px solid var(--prussian-blue);
        }
        td {
            padding: 6px 8px;
            border-bottom: 1px solid var(--alabaster);
        }
        th:nth-child(1) { width: 35%; }
        th:nth-child(2) { width: 20%; }
        th:nth-child(3) { width: 25%; }
        th:nth-child(4) { width: 20%; }

        /* --- Start Button --- */
        #startBtn {
            background-color: var(--orange);
            color: var(--black);
            border: none;
            padding: 14px;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 10px;
        }
        #startBtn:hover {
            background-color: var(--orange-hover);
        }
        #startBtn:disabled {
            background-color: var(--alabaster);
            cursor: not-allowed;
            color: #888;
        }

        /* --- Stop Button --- */
        #stopBtn {
            background-color: var(--prussian-blue) !important;
            color: var(--white) !important;
        }
        #stopBtn:hover {
            background-color: var(--prussian-light) !important;
        }

        /* --- Log Box --- */
        #logBox {
            background-color: var(--prussian-blue);
            border: 1px solid var(--black);
            border-radius: 6px;
            height: 120px;
            padding: 10px;
            overflow-y: auto;
            font-size: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            margin-bottom: 15px;
            color: var(--alabaster);
        }

        /* --- Results Section --- */
        #resultsInfo {
            padding: 10px;
            background-color: var(--alabaster);
            border-radius: 6px;
            color: var(--prussian-blue);
            text-align: center;
            font-weight: 600;
            margin-bottom: 8px;
            border: 1px solid var(--prussian-blue);
        }
        
        /* --- Export Button --- */
        #exportCsvBtn {
            background-color: var(--orange);
            color: var(--black);
            border: none;
            padding: 12px;
            width: 100%;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 15px;
        }
        #exportCsvBtn:hover {
            background-color: var(--orange-hover);
        }

        /* --- Storage Info --- */
        #storageInfo {
            font-size: 11px;
            color: var(--prussian-blue);
            text-align: center;
            padding: 5px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        /* --- Management Buttons --- */
        .mgmt-buttons {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }
        .mgmt-btn {
            flex: 1;
            min-width: 0;
            padding: 8px 4px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10px;
            font-weight: 600;
            transition: all 0.2s;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .mgmt-btn.reset {
            background-color: var(--white);
            color: var(--prussian-blue);
            border: 1px solid var(--prussian-blue);
        }
        .mgmt-btn.reset:hover {
            background-color: var(--alabaster);
        }
        .mgmt-btn.danger {
            background-color: var(--white);
            color: var(--prussian-blue);
            border: 1px solid var(--prussian-blue);
        }
        .mgmt-btn.danger:hover {
            background-color: var(--alabaster);
        }

        /* --- Table Action Buttons --- */
        .delete-btn, .reset-btn {
            border-radius: 4px;
            cursor: pointer;
            padding: 4px 6px;
            font-size: 11px;
            transition: all 0.2s;
        }
        .delete-btn {
            background-color: var(--white);
            border: 1px solid var(--prussian-blue);
            color: var(--prussian-blue);
        }
        .delete-btn:hover {
            background-color: var(--alabaster);
        }
        .reset-btn {
            background-color: var(--orange);
            border: 1px solid var(--orange);
            color: var(--black);
            margin-right: 4px;
        }
        .reset-btn:hover {
            background-color: var(--orange-hover);
        }

        /* Hide the file input */
        #hiddenFileInput {
            display: none;
        }

        /* Divider */
        .divider {
            height: 1px;
            background: var(--alabaster);
            margin: 15px 0;
        }

        /* Copy Logs Button */
        .copy-logs-btn {
            background-color: var(--alabaster);
            color: var(--prussian-blue);
            border: 1px solid var(--prussian-blue);
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .copy-logs-btn:hover {
            background-color: var(--prussian-blue);
            color: var(--white);
        }
        .copy-logs-btn.copied {
            background-color: var(--orange);
            color: var(--black);
            border-color: var(--orange);
        }

        /* Job Stats */
        .job-stats {
            display: flex;
            gap: 10px;
            background: var(--alabaster);
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 12px;
            border: 1px solid var(--prussian-blue);
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        .stat-label {
            color: var(--prussian-blue);
            font-weight: 500;
        }
        .stat-value {
            background: var(--white);
            color: var(--prussian-blue);
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid var(--prussian-blue);
            font-size: 11px;
        }
        .stat-item.total .stat-value {
            background: var(--orange);
            color: var(--black);
            border-color: var(--orange);
        }
    </style>
</head>
<body>

    <!-- ========== STEP 1: UPLOAD ========== -->
    <div class="section-header">
        <span class="step-num">1</span> Upload JSON Files
    </div>
    <button id="computerBtn" title="Click to select one or more JSON files from your computer">
        üìÅ Select Files from Computer
    </button>
    <input type="file" id="hiddenFileInput" accept=".json" multiple>

    <!-- ========== STEP 2: FILE QUEUE ========== -->
    <div class="section-header">
        <span class="step-num">2</span> File Queue
    </div>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Jobs</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="jobTableBody">
            <tr>
                <td colspan="4" style="text-align:center; color:#999;">No files uploaded yet</td>
            </tr>
        </tbody>
    </table>
    
    <!-- Stats Summary -->
    <div id="jobStats" class="job-stats">
        <div class="stat-item">
            <span class="stat-label">üë®‚Äçüíº Parent Jobs:</span>
            <span class="stat-value" id="parentJobsCount">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">üë∂ Child Jobs:</span>
            <span class="stat-value" id="childJobsCount">0</span>
        </div>
        <div class="stat-item total">
            <span class="stat-label">üìä Total:</span>
            <span class="stat-value" id="totalJobsCount">0</span>
        </div>
    </div>

    <!-- ========== STEP 3: START PROCESSING ========== -->
    <div class="section-header">
        <span class="step-num">3</span> Process with Gemini
    </div>
    <div style="display: flex; gap: 8px; margin-bottom: 10px; align-items: stretch;">
        <button id="startBtn" style="flex: 2; margin-bottom: 0;" title="Start sending jobs to Gemini AI for extraction. Make sure Gemini is open in another tab!">
            ‚ñ∂Ô∏è Start Processing
        </button>
        <button id="stopBtn" style="flex: 1; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px;" title="Stop processing. You can resume later by clicking Start again.">
            ‚èπÔ∏è Stop
        </button>
    </div>

    <!-- ========== STEP 4: PROGRESS LOG ========== -->
    <div class="section-header" style="justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 6px;">
            <span class="step-num">4</span> Progress Log
        </div>
        <button id="copyLogsBtn" class="copy-logs-btn" title="Copy all logs to clipboard">
            üìã Copy
        </button>
    </div>
    <div id="logBox"></div>

    <!-- ========== STEP 5: RESULTS & EXPORT ========== -->
    <div class="section-header">
        <span class="step-num">5</span> Results
    </div>
    <div id="resultsInfo">üìä 0 jobs extracted - ready for export</div>
    <button id="exportCsvBtn" title="Download all extracted results as a CSV file. Auto-exports when all files complete!">
        üì• Export Results as CSV
    </button>

    <div class="divider"></div>

    <!-- ========== STORAGE & MANAGEMENT ========== -->
    <div class="section-header" style="margin-top: 5px;">
        <span style="font-size: 14px;">‚öôÔ∏è</span> Storage & Management
    </div>
    <div id="storageInfo">üíæ Loading...</div>
    
    <div class="mgmt-buttons">
        <button class="mgmt-btn reset" id="resetAllBtn" 
            title="Reset all files back to Pending status so you can reprocess them through Gemini">
            üîÑ Reset All Jobs
        </button>
        <button class="mgmt-btn danger" id="clearCompletedBtn"
            title="Remove completed files from the queue to free up storage space (keeps results)">
            üóëÔ∏è Clear Completed
        </button>
    </div>
    <div class="mgmt-buttons">
        <button class="mgmt-btn danger" id="clearResultsBtn"
            title="‚ö†Ô∏è Delete ALL extracted results. Make sure you've exported first!">
            üóëÔ∏è Clear All Results
        </button>
    </div>

    <script src="db.js"></script>
    <script src="sidepanel.js"></script>
</body>
</html>
