<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Client Extractor</title>
    <style>
        * {
            box-sizing: border-box;
        }
        html, body {
            min-width: 280px;  /* Minimum width the panel can shrink to */
            max-width: 100%;
            overflow-x: hidden;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 12px;
            color: #333;
            background-color: #ffffff;
            margin: 0;
        }

        /* --- Section Headers --- */
        .section-header {
            font-size: 14px;
            font-weight: 700;
            color: #555;
            margin: 15px 0 8px 0;
            padding-bottom: 4px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .section-header .step-num {
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
        }

        /* --- Upload Button --- */
        #computerBtn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 14px;
            width: 100%;
            font-size: 15px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 10px;
        }
        #computerBtn:hover {
            background-color: #1976D2;
        }

        /* --- Table --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            table-layout: fixed;  /* Allows table to shrink */
        }
        td, th {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        thead {
            background-color: #e3f2fd;
        }
        th {
            text-align: left;
            padding: 8px;
            font-weight: bold;
            color: #1565C0;
            border-bottom: 2px solid #90CAF9;
        }
        td {
            padding: 6px 8px;
            border-bottom: 1px solid #eee;
        }
        th:nth-child(1) { width: 35%; }
        th:nth-child(2) { width: 20%; }
        th:nth-child(3) { width: 25%; }
        th:nth-child(4) { width: 20%; }

        /* --- Start Button --- */
        #startBtn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 14px;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 10px;
        }
        #startBtn:hover {
            background-color: #388E3C;
        }
        #startBtn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            color: #666;
        }

        /* --- Log Box --- */
        #logBox {
            background-color: #263238;
            border: 1px solid #37474F;
            border-radius: 6px;
            height: 120px;
            padding: 10px;
            overflow-y: auto;
            font-size: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            margin-bottom: 15px;
            color: #B0BEC5;
        }

        /* --- Results Section --- */
        #resultsInfo {
            padding: 10px;
            background-color: #E8F5E9;
            border-radius: 6px;
            color: #2E7D32;
            text-align: center;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        /* --- Export Button --- */
        #exportCsvBtn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 15px;
        }
        #exportCsvBtn:hover {
            background-color: #388E3C;
        }

        /* --- Storage Info --- */
        #storageInfo {
            font-size: 11px;
            color: #666;
            text-align: center;
            padding: 5px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        /* --- Management Buttons --- */
        .mgmt-buttons {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }
        .mgmt-btn {
            flex: 1;
            min-width: 0;  /* Allow shrinking */
            padding: 8px 4px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10px;
            font-weight: 600;
            transition: background 0.2s;
            border: 1px solid;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .mgmt-btn.reset {
            background-color: #FFF3E0;
            color: #E65100;
            border-color: #FFB74D;
        }
        .mgmt-btn.reset:hover {
            background-color: #FFE0B2;
        }
        .mgmt-btn.danger {
            background-color: #FFEBEE;
            color: #C62828;
            border-color: #EF9A9A;
        }
        .mgmt-btn.danger:hover {
            background-color: #FFCDD2;
        }

        /* --- Table Action Buttons --- */
        .delete-btn, .reset-btn {
            border-radius: 4px;
            cursor: pointer;
            padding: 4px 6px;
            font-size: 11px;
            border: 1px solid;
        }
        .delete-btn {
            background-color: #FFEBEE;
            border-color: #EF9A9A;
            color: #C62828;
        }
        .reset-btn {
            background-color: #FFF3E0;
            border-color: #FFB74D;
            color: #E65100;
            margin-right: 4px;
        }

        /* Hide the file input */
        #hiddenFileInput {
            display: none;
        }

        /* Divider */
        .divider {
            height: 1px;
            background: #e0e0e0;
            margin: 15px 0;
        }
    </style>
</head>
<body>

    <!-- ========== STEP 1: UPLOAD ========== -->
    <div class="section-header">
        <span class="step-num">1</span> Upload JSON Files
    </div>
    <button id="computerBtn" title="Click to select one or more JSON files from your computer">
        üìÅ Select Files from Computer
    </button>
    <input type="file" id="hiddenFileInput" accept=".json" multiple>

    <!-- ========== STEP 2: FILE QUEUE ========== -->
    <div class="section-header">
        <span class="step-num">2</span> File Queue
    </div>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Jobs</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="jobTableBody">
            <tr>
                <td colspan="4" style="text-align:center; color:#999;">No files uploaded yet</td>
            </tr>
        </tbody>
    </table>

    <!-- ========== STEP 3: START PROCESSING ========== -->
    <div class="section-header">
        <span class="step-num">3</span> Process with Gemini
    </div>
    <div style="display: flex; gap: 8px; margin-bottom: 10px; align-items: stretch;">
        <button id="startBtn" style="flex: 2; margin-bottom: 0;" title="Start sending jobs to Gemini AI for extraction. Make sure Gemini is open in another tab!">
            ‚ñ∂Ô∏è Start Processing
        </button>
        <button id="stopBtn" style="flex: 1; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px;" title="Stop processing. You can resume later by clicking Start again.">
            ‚èπÔ∏è Stop
        </button>
    </div>

    <!-- ========== STEP 4: PROGRESS LOG ========== -->
    <div class="section-header">
        <span class="step-num">4</span> Progress Log
    </div>
    <div id="logBox"></div>

    <!-- ========== STEP 5: RESULTS & EXPORT ========== -->
    <div class="section-header">
        <span class="step-num">5</span> Results
    </div>
    <div id="resultsInfo">üìä 0 jobs extracted - ready for export</div>
    <button id="exportCsvBtn" title="Download all extracted results as a CSV file. Auto-exports when all files complete!">
        üì• Export Results as CSV
    </button>

    <div class="divider"></div>

    <!-- ========== STORAGE & MANAGEMENT ========== -->
    <div class="section-header" style="margin-top: 5px;">
        <span style="font-size: 14px;">‚öôÔ∏è</span> Storage & Management
    </div>
    <div id="storageInfo">üíæ Loading...</div>
    
    <div class="mgmt-buttons">
        <button class="mgmt-btn reset" id="resetAllBtn" 
            title="Reset all files back to Pending status so you can reprocess them through Gemini">
            üîÑ Reset All Jobs
        </button>
        <button class="mgmt-btn danger" id="clearCompletedBtn"
            title="Remove completed files from the queue to free up storage space (keeps results)">
            üóëÔ∏è Clear Completed
        </button>
    </div>
    <div class="mgmt-buttons">
        <button class="mgmt-btn danger" id="clearResultsBtn"
            title="‚ö†Ô∏è Delete ALL extracted results. Make sure you've exported first!">
            üóëÔ∏è Clear All Results
        </button>
    </div>

    <script src="db.js"></script>
    <script src="sidepanel.js"></script>
</body>
</html>
